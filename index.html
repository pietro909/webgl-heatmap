<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8"/>
  <title>WebGL heatmap</title>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  
  <script type="text/javascript" src="node_modules/openlayers/dist/ol-debug.js" ></script>
  <script type="text/javascript" src="node_modules/pixi.js/bin/pixi.js" ></script>
  <script type="text/javascript" src="src/MV.js" ></script>
  <script type="text/javascript" src="src/webgl-utils.js" ></script>
    <script type="text/javascript" src="src/initShaders.js" ></script>

  <script type="text/javascript" src="src/main.js" ></script>
  
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 vPosition;
        attribute vec4 vColor;

        /* point attributes */
        attribute float vUplink;
        attribute float vDownlink;
        attribute float vPmkpi;

	/* const for the whole map */
	uniform float u_UpLinkMax;
	uniform float u_DownLinkMax;
	uniform float u_PmKpiMax;

	/* dynamic center */
	uniform vec2 u_centerPoint;
	uniform float u_zoom;
	uniform float u_coordsScale;

	uniform int u_marker;

        varying vec4 fColor;
	
	float greenComponent;

	// it's working only with u_zoom = 5.0
	float zoomFactor = pow( 10.0, u_zoom );

	// not sure how to use this one
	float coordsScale = pow( 10.0, u_coordsScale - u_zoom );

        void main()
        {
            gl_Position = vec4( ( vPosition.x  - ( u_centerPoint.x / u_zoom ) ),
                                ( vPosition.y  - ( u_centerPoint.y / u_zoom ) ), 
	                        vPosition.z,
	                        vPosition.w
	                      );

	    gl_PointSize = 1.0;

	    if ( u_marker == 1 ) 
	    {
                greenComponent = vUplink / u_UpLinkMax;
	    }
	    else if ( u_marker == 2 )
	    {
	        greenComponent = vDownlink / u_DownLinkMax;
	    }
	    else
	    {
	        greenComponent = vPmkpi / u_PmKpiMax;
	    }

            fColor = vec4( vColor.x, 
                           greenComponent, 
                           vColor.z, 
                           vColor.w 
                          );
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        varying vec4 fColor;

        void main()
        {
            gl_FragColor = fColor; //vec4(1.0, 0.0, 0.0, 1.0);
        }
    </script>

</head>

<body onload="onLoad()" >
  <article>
<header>
  <select id="changeMarker">
    <option value=1 selected >UPLINK</option>
    <option value=2 >DOWNLINK</option>
    <option value=3 >PM-KPI</option>
  </select>
  <h3 id="vertices"></h3>
</header>
    <section>
      <canvas id="theCanvas" width="800" height="600" ></canvas>
      <div id="theMap"></div>
    </section>
  </article>
</body>

</html>
